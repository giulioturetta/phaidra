# -*- truncate-lines: nil; -*-

#+OPTIONS: toc:nil ^:nil
#+STARTUP: overview

* About
This file is used for generating the technical sketches included in the frontpage of this repository (~README.md~).
* Demo version
#+NAME: construction-demo
#+begin_src dot :file "./pictures/construction_demo.svg"
  graph G {
          rankdir="LR"
          subgraph cluster_host {
                  label = "PHAIDRA server firewall";
                  color = red;
                  USER [label="PHAIDRA USER", shape = tripleoctagon];
                  subgraph cluster_host_storage {
                          label = "PHAIDRA server filesystem";
                          color = blue;
                          subgraph cluster_named_volumes {
                                  label = "Named volumes";
                                  color = turquoise;
                                  node [shape = folder, style = solid, color = turquoise]
                                  HS_FEDORA [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_fedora/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">fedora-container:<br align="left" /></td>
                                             <td align="text">/usr/local/tomcat/fcrepo-home<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">pixelgecko-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">api-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_mariadb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                                      <td align="text">/var/lib/mysql<br align="left" /></td>
                                                      </tr>
                                                      </table>
                                                      >];
                                  HS_MONGODB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_mongodb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">phaidra-mongodb-container:<br align="left" /></td>
                                                      <td align="text">/data/db<br align="left" /></td></tr>
                                                      </table>
                                                      >];
                                  HS_OPENLDAP [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_openldap/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">openldap-container:<br align="left" /></td>
                                               <td align="text">/bitnami/openldap<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_SOLR [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_solr/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">solr-container:<br align="left" /></td>
                                           <td align="text">/var/solr<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];
                                  HS_PIXELGECKO [label=<
                                                 <table border="0">
                                                 <tr>
                                                 <td align="text"><b>host:</b><br align="left" /></td>
                                                 <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_pixelgecko/_data<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">pixelgecko-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">imageserver-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images:ro<br align="left" /></td>
                                                 </tr>
                                                 </table>
                                                 >];
                                  HS_DBGATE [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_dbgate/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">dbgate-container:<br align="left" /></td>
                                             <td align="text">/root/.dbgate<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_FEDORA [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_mariadb_fedora/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">mariadb-fedora-container:<br align="left" /></td>
                                                     <td align="text">/var/lib/mysql<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_DATABASE_DUMPS [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_chronos_database_dumps/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">chronos-container:<br align="left" /></td>
                                                     <td align="text">/mnt/database-dumps<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_SITEMAPS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_chronos_sitemaps/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">httpd-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps:ro<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_OAI_LOGS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_chronos_oai_logs/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/oai-logs<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_GRAFANA [label=<
                                              <table border="0">
                                              <tr>
                                              <td align="text"><b>host:</b><br align="left" /></td>
                                              <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_grafana/_data<br align="left" /></td>
                                              </tr>
                                              <tr>
                                              <td align="text">grafana-container:<br align="left" /></td>
                                              <td align="text">/var/lib/grafana<br align="left" /></td>
                                              </tr>
                                              </table>
                                              >];
                                  HS_LOKI [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_loki/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">loki-container:<br align="left" /></td>
                                           <td align="text">/loki<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];

  }
  subgraph cluster_bind_mounts {
          label = "Bind mounts";
          node [shape = folder, style = solid, color = blue]
          BIND_MARIADB_PHAIDRA_INIT[label=<
                                    <table border="0">
                                    <tr>
                                    <td align="text"><b>host:</b><br align="left" /></td>
                                    <td align="text">$REPO/container_init/mariadb/phaidradb.sql.gz<br align="left" /></td>
                                    </tr>
                                    <tr>
                                    <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                    <td align="text">/docker-entrypoint-initdb.d/phaidradb.sql.gz:ro<br align="left" /></td>
                                    </tr>
                                    </table>
                                    >];
          BIND_OPENLDAP_INIT [label=<
                              <table border="0">
                              <tr>
                              <td align="text"><b>host:</b><br align="left" /></td>
                              <td align="text">$REPO/container_init/openldap<br align="left" /></td>
                              </tr>
                              <tr>
                              <td align="text">openldap-container:<br align="left" /></td>
                              <td align="text">/ldifs:ro<br align="left" /></td>
                              </tr>
                              </table>
                              >];
          BIND_HTTPD_CONFIG [label=<
                             <table border="0">
                             <tr>
                             <td align="text"><b>host:</b><br align="left" /></td>
                             <td align="text">$REPO/container_init/httpd/phaidra-demo<br align="left" /></td>
                             </tr>
                             <tr>
                             <td align="text">httpd-container:<br align="left" /></td>
                             <td align="text">/mnt/startup:ro<br align="left" /></td>
                             </tr>
                             </table>
                             >];
          BIND_API_CODE [label=<
                         <table border="0">
                         <tr>
                         <td align="text"><b>host:</b><br align="left" /></td>
                         <td align="text">$REPO/src/phaidra-api<br align="left" /></td>
                         </tr>
                         <tr>
                         <td align="text">api-container:<br align="left" /></td>
                         <td align="text">/usr/local/phaidra/phaidra-api:ro<br align="left" /></td>
                         </tr>
                         </table>
                         >];
          BIND_API_ENTRYPOINT [label=<
                               <table border="0">
                               <tr>
                               <td align="text"><b>host:</b><br align="left" /></td>
                               <td align="text">$REPO/container_init/api/api-entrypoint.bash<br align="left" /></td>
                               </tr>
                               <tr>
                               <td align="text">api-container:<br align="left" /></td>
                               <td align="text">/mnt/api-entrypoint.bash:ro<br align="left" /></td>
                               </tr>
                               </table>
                               >];
          BIND_DOCUMENTATION [label=<
                              <table border="0">
                              <tr>
                              <td align="text"><b>host:</b><br align="left" /></td>
                              <td align="text">$REPO/docs<br align="left" /></td>
                              </tr>
                              <tr>
                              <td align="text">httpd-container:<br align="left" /></td>
                              <td align="text">/mnt/docs:ro<br align="left" /></td>
                              </tr>
                              </table>
                              >];
          BIND_CHRONOS [label=<
                        <table border="0">
                        <tr>
                        <td align="text"><b>host:</b><br align="left" /></td>
                        <td align="text">$REPO/container_init/chronos<br align="left" /></td>
                        </tr>
                        <tr>
                        <td align="text">chronos-container:<br align="left" /></td>
                        <td align="text">/mnt/chronos:ro<br align="left" /></td>
                        </tr>
                        </table>
                        >];
          BIND_MONGODB_INIT_OAI [label=<
                                 <table border="0">
                                 <tr>
                                 <td align="text"><b>host:</b><br align="left" /></td>
                                 <td align="text">$REPO/container_init/mongodb/init_oai_sets.json<br align="left" /></td>
                                 </tr>
                                 <tr>
                                 <td align="text">mongodb-container:<br align="left" /></td>
                                 <td align="text">/mnt/init_oai_sets.json:ro<br align="left" /></td>
                                 </tr>
                                 </table>
                                 >];
          BIND_MONGODB_INIT [label=<
                             <table border="0">
                             <tr>
                             <td align="text"><b>host:</b><br align="left" /></td>
                             <td align="text">$REPO/container_init/mongodb/mongodb-after-entry.sh<br align="left" /></td>
                             </tr>
                             <tr>
                             <td align="text">mongodb-container:<br align="left" /></td>
                             <td align="text">/docker-entrypoint-initdb.d/mongodb-after-entry.sh:ro<br align="left" /></td>
                             </tr>
                             </table>
                             >];
          BIND_SOLR_INIT [label=<
                          <table border="0">
                          <tr>
                          <td align="text"><b>host:</b><br align="left" /></td>
                          <td align="text">$REPO/container_init/solr/phaidra_core<br align="left" /></td>
                          </tr>
                          <tr>
                          <td align="text">solr-container:<br align="left" /></td>
                          <td align="text">/tmp/phaidra:ro<br align="left" /></td>
                          </tr>
                          </table>
                          >];
          BIND_PIXELGECKO [label=<
                           <table border="0">
                           <tr>
                           <td align="text"><b>host:</b><br align="left" /></td>
                           <td align="text">$REPO/src/pixelgecko<br align="left" /></td>
                           </tr>
                           <tr>
                           <td align="text">pixelgecko-container:<br align="left" /></td>
                           <td align="text">/opt/pixelgecko:ro<br align="left" /></td>
                           </tr>
                           </table>
                           >];
          BIND_PROMTAIL_LOCAL [label=<
                               <table border="0">
                               <tr>
                               <td align="text"><b>host:</b><br align="left" /></td>
                               <td align="text">$REPO/container_init/promtail/promtail-local-config.yaml<br align="left" /></td>
                               </tr>
                               <tr>
                               <td align="text">promtail-local-container:<br align="left" /></td>
                               <td align="text">/etc/promtail/config.yaml:ro<br align="left" /></td>
                               </tr>
                               </table>
                               >];
          BIND_LOKI [label=<
                     <table border="0">
                     <tr>
                     <td align="text"><b>host:</b><br align="left" /></td>
                     <td align="text">$REPO/container_init/loki/loki-docker-config.yaml<br align="left" /></td>
                     </tr>
                     <tr>
                     <td align="text">loki-container:<br align="left" /></td>
                     <td align="text">/etc/loki/local-config.yaml:ro<br align="left" /></td>
                     </tr>
                     </table>
                     >];
          BIND_GRAFANA_DS [label=<
                           <table border="0">
                           <tr>
                           <td align="text"><b>host:</b><br align="left" /></td>
                           <td align="text">$REPO/container_init/grafana/ds.yaml<br align="left" /></td>
                           </tr>
                           <tr>
                           <td align="text">grafana-container:<br align="left" /></td>
                           <td align="text">/etc/grafana/provisioning/datasources/ds.yaml:ro<br align="left" /></td>
                           </tr>
                           </table>
                           >];
          BIND_GRAFANA_DD [label=<
                           <table border="0">
                           <tr>
                           <td align="text"><b>host:</b><br align="left" /></td>
                           <td align="text">$REPO/container_init/grafana/dd.yaml<br align="left" /></td>
                           </tr>
                           <tr>
                           <td align="text">grafana-container:<br align="left" /></td>
                           <td align="text">/etc/grafana/provisioning/dashboards/dd.yaml:ro<br align="left" /></td>
                           </tr>
                           </table>
                           >];
          BIND_GRAFANA_DASHBOARDS [label=<
                                   <table border="0">
                                   <tr>
                                   <td align="text"><b>host:</b><br align="left" /></td>
                                   <td align="text">$REPO/container_init/grafana/dashboards<br align="left" /></td>
                                   </tr>
                                   <tr>
                                   <td align="text">grafana-container:<br align="left" /></td>
                                   <td align="text">/etc/grafana/provisioning/dashboards:ro<br align="left" /></td>
                                   </tr>
                                   </table>
                                   >];

  }
  }

  subgraph cluster_docker_network_host {
          label="PHAIDRA docker containers";
          color = green;
          node [shape = component, style = solid, color = green]
          C_FEDORA [label="phaidra-demo-fedora-1",
                    URL="https://fedora.lyrasis.org/"];
          C_API [label="phaidra-demo-api-1",
                 URL="https://github.com/phaidra/phaidra-api"];
          C_MARIADB_PHAIDRA [label="phaidra-demo-mariadb-phaidra-1",
                             URL="https://mariadb.org/"];
          C_MONGODB_PHAIDRA [label="phaidra-demo-mongodb-phaidra-1",
                             URL="https://www.mongodb.com/"];
          C_UI [label="phaidra-demo-ui-1",
                URL="https://github.com/phaidra/phaidra-ui"];
          C_OPENLDAP [label="phaidra-demo-openldap-1",
                      URL="https://www.openldap.org/"];
          C_SOLR [label="phaidra-demo-solr-1",
                  URL="https://solr.apache.org/"];
          C_IMAGESERVER [label="phaidra-demo-imageserver-1",
                         URL="https://github.com/ruven/iipsrv"];
          C_PIXELGECKO [label="phaidra-demo-pixelgecko-1"];
          C_DBGATE [label="phaidra-demo-dbgate-1"];
          C_LAM [label="phaidra-demo-lam-1"];
          C_MARIADB_FEDORA [label="phaidra-demo-mariadb-fedora-1",
                            URL="https://mariadb.org/"];
          C_CHRONOS [label="phaidra-demo-chronos-1"];
          WEBSERVER [label="phaidra-demo-httpd-1"];
          C_PROMTAIL_LOCAL [label="phaidra-demo-promtail-local-1",
                            URL="https://grafana.com/docs/loki/latest/send-data/promtail/"];
          C_GRAFANA [label="phaidra-demo-grafana-1",
                     URL="https://grafana.com/docs/grafana/latest/getting-started/"];
          C_LOKI [label="phaidra-demo-loki-1",
                  URL="https://grafana.com/docs/loki/latest/"];
          }
  }

  // storage mapping

  HS_FEDORA -- C_FEDORA [color="turquoise"];

  HS_FEDORA -- C_API [color="turquoise"];
  BIND_API_CODE, BIND_API_ENTRYPOINT -- C_API [color="blue"];

  BIND_MARIADB_PHAIDRA_INIT-- C_MARIADB_PHAIDRA [color="blue"];
  HS_MARIADB_PHAIDRA -- C_MARIADB_PHAIDRA [color="turquoise"];

  HS_MONGODB_PHAIDRA -- C_MONGODB_PHAIDRA [color="turquoise"];
  BIND_MONGODB_INIT,BIND_MONGODB_INIT_OAI -- C_MONGODB_PHAIDRA [color="blue"];

  HS_OPENLDAP -- C_OPENLDAP [color="turquoise"];
  BIND_OPENLDAP_INIT -- C_OPENLDAP [color="blue"];

  HS_SOLR -- C_SOLR [color="turquoise"];
  BIND_SOLR_INIT -- C_SOLR [color="blue"];

  HS_PIXELGECKO -- C_IMAGESERVER [color="turquoise"];

  HS_FEDORA -- C_PIXELGECKO [color="turquoise"];
  HS_PIXELGECKO -- C_PIXELGECKO [color="turquoise"];
  BIND_PIXELGECKO -- C_PIXELGECKO [color="blue"];

  HS_DBGATE -- C_DBGATE [color="turquoise"];

  HS_MARIADB_FEDORA -- C_MARIADB_FEDORA [color="turquoise"];

  WEBSERVER -- BIND_HTTPD_CONFIG,BIND_DOCUMENTATION [color="blue"];
  WEBSERVER -- HS_SITEMAPS [color="turquoise"];

  C_CHRONOS -- HS_DATABASE_DUMPS,HS_SITEMAPS,HS_OAI_LOGS [color="turquoise"];
  C_CHRONOS -- BIND_CHRONOS [color="blue"];

  C_GRAFANA -- HS_GRAFANA [color="turquoise"];
  C_GRAFANA -- BIND_GRAFANA_DD, BIND_GRAFANA_DS, BIND_GRAFANA_DASHBOARDS [color="blue"];

  C_LOKI -- HS_LOKI [color="turquoise"];
  C_LOKI -- BIND_LOKI [color="blue"];

  C_PROMTAIL_LOCAL -- BIND_PROMTAIL_LOCAL [color="blue"];

  // system communication mapping

  C_FEDORA -- C_MARIADB_FEDORA [color="orange"];
  C_API -- C_FEDORA,C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_UI,C_OPENLDAP,C_SOLR,C_IMAGESERVER [color="orange"];
  C_MONGODB_PHAIDRA -- C_PIXELGECKO [color="orange"];
  C_OPENLDAP -- C_LAM [color="orange"];
  C_DBGATE -- C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_MARIADB_FEDORA [color="orange"];
  WEBSERVER -- C_FEDORA,C_API,C_UI,C_SOLR,C_DBGATE,C_LAM, C_GRAFANA [color="magenta"];
  C_CHRONOS -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API [color="orange"];
  C_PROMTAIL_LOCAL -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API,C_UI,C_IMAGESERVER,WEBSERVER,C_OPENLDAP,C_LAM,C_DBGATE,C_CHRONOS,C_PIXELGECKO, C_FEDORA [color="black"];
  C_PROMTAIL_LOCAL -- C_LOKI [color="orange"];
  C_GRAFANA -- C_LOKI [color="orange"];


  // outside communication mapping

  USER -- WEBSERVER [color="green"];
  }
#+end_src

#+RESULTS: construction-demo
[[file:./pictures/construction_demo.svg]]

* SSL version
#+NAME: construction-ssl
#+begin_src dot :file "./pictures/construction_ssl.svg"
  graph G {
          rankdir="LR"

          USER [label="PHAIDRA USER", shape = tripleoctagon];

          subgraph cluster_host {
                  label = "PHAIDRA server firewall";
                  color = red;

                  subgraph cluster_host_storage {
                          label = "PHAIDRA server filesystem";
                          color = blue;
                          subgraph cluster_named_volumes {
                                  label = "Named volumes";
                                  color = turquoise;
                                  node [shape = folder, style = solid, color = turquoise]
                                  HS_FEDORA [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_fedora/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">fedora-container:<br align="left" /></td>
                                             <td align="text">/usr/local/tomcat/fcrepo-home<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">pixelgecko-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">api-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_mariadb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                                      <td align="text">/var/lib/mysql<br align="left" /></td>
                                                      </tr>
                                                      </table>
                                                      >];
                                  HS_MONGODB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_mongodb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">phaidra-mongodb-container:<br align="left" /></td>
                                                      <td align="text">/data/db<br align="left" /></td></tr>
                                                      </table>
                                                      >];
                                  HS_OPENLDAP [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_openldap/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">openldap-container:<br align="left" /></td>
                                               <td align="text">/bitnami/openldap<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_SOLR [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_solr/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">solr-container:<br align="left" /></td>
                                           <td align="text">/var/solr<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];
                                  HS_PIXELGECKO [label=<
                                                 <table border="0">
                                                 <tr>
                                                 <td align="text"><b>host:</b><br align="left" /></td>
                                                 <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_pixelgecko/_data<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">pixelgecko-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">imageserver-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images:ro<br align="left" /></td>
                                                 </tr>
                                                 </table>
                                                 >];
                                  HS_DBGATE [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_dbgate/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">dbgate-container:<br align="left" /></td>
                                             <td align="text">/root/.dbgate<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_FEDORA [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_mariadb_fedora/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">mariadb-fedora-container:<br align="left" /></td>
                                                     <td align="text">/var/lib/mysql<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_DATABASE_DUMPS [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_chronos_database_dumps/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">chronos-container:<br align="left" /></td>
                                                     <td align="text">/mnt/database-dumps<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_SITEMAPS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_chronos_sitemaps/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">httpd-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps:ro<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_OAI_LOGS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-ssl_chronos_oai_logs/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/oai-logs<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_GRAFANA [label=<
                                              <table border="0">
                                              <tr>
                                              <td align="text"><b>host:</b><br align="left" /></td>
                                              <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_grafana/_data<br align="left" /></td>
                                              </tr>
                                              <tr>
                                              <td align="text">grafana-container:<br align="left" /></td>
                                              <td align="text">/var/lib/grafana<br align="left" /></td>
                                              </tr>
                                              </table>
                                              >];
                                  HS_LOKI [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_loki/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">loki-container:<br align="left" /></td>
                                           <td align="text">/loki<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];
                                   }
                                   subgraph cluster_bind_mounts {
                                           label = "Bind mounts";
                                           node [shape = folder, style = solid, color = blue]
                                           BIND_MARIADB_PHAIDRA_INIT[label=<
                                                                     <table border="0">
                                                                     <tr>
                                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                                     <td align="text">$REPO/container_init/mariadb/phaidradb.sql.gz<br align="left" /></td>
                                                                     </tr>
                                                                     <tr>
                                                                     <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                                                     <td align="text">/docker-entrypoint-initdb.d/phaidradb.sql.gz:ro<br align="left" /></td>
                                                                     </tr>
                                                                     </table>
                                                                     >];
                                           BIND_OPENLDAP_INIT [label=<
                                                               <table border="0">
                                                               <tr>
                                                               <td align="text"><b>host:</b><br align="left" /></td>
                                                               <td align="text">$REPO/container_init/openldap<br align="left" /></td>
                                                               </tr>
                                                               <tr>
                                                               <td align="text">openldap-container:<br align="left" /></td>
                                                               <td align="text">/ldifs:ro<br align="left" /></td>
                                                               </tr>
                                                               </table>
                                                               >];
                                           BIND_HTTPD_CONFIG [label=<
                                                              <table border="0">
                                                              <tr>
                                                              <td align="text"><b>host:</b><br align="left" /></td>
                                                              <td align="text">$REPO/container_init/httpd/phaidra-ssl<br align="left" /></td>
                                                              </tr>
                                                              <tr>
                                                              <td align="text">httpd-container:<br align="left" /></td>
                                                              <td align="text">/mnt/startup:ro<br align="left" /></td>
                                                              </tr>
                                                              </table>
                                                              >];
                                           BIND_API_CODE [label=<
                                                          <table border="0">
                                                          <tr>
                                                          <td align="text"><b>host:</b><br align="left" /></td>
                                                          <td align="text">$REPO/src/phaidra-api<br align="left" /></td>
                                                          </tr>
                                                          <tr>
                                                          <td align="text">api-container:<br align="left" /></td>
                                                          <td align="text">/usr/local/phaidra/phaidra-api:ro<br align="left" /></td>
                                                          </tr>
                                                          </table>
                                                          >];
                                           BIND_API_ENTRYPOINT [label=<
                                                                <table border="0">
                                                                <tr>
                                                                <td align="text"><b>host:</b><br align="left" /></td>
                                                                <td align="text">$REPO/container_init/api/api-entrypoint.bash<br align="left" /></td>
                                                                </tr>
                                                                <tr>
                                                                <td align="text">api-container:<br align="left" /></td>
                                                                <td align="text">/mnt/api-entrypoint.bash:ro<br align="left" /></td>
                                                                </tr>
                                                                </table>
                                                                >];

                                           BIND_DOCUMENTATION [label=<
                                                               <table border="0">
                                                               <tr>
                                                               <td align="text"><b>host:</b><br align="left" /></td>
                                                               <td align="text">$REPO/docs<br align="left" /></td>
                                                               </tr>
                                                               <tr>
                                                               <td align="text">httpd-container:<br align="left" /></td>
                                                               <td align="text">/mnt/docs:ro<br align="left" /></td>
                                                               </tr>
                                                               </table>
                                                               >];
                                           BIND_CHRONOS [label=<
                                                         <table border="0">
                                                         <tr>
                                                         <td align="text"><b>host:</b><br align="left" /></td>
                                                         <td align="text">$REPO/container_init/chronos<br align="left" /></td>
                                                         </tr>
                                                         <tr>
                                                         <td align="text">chronos-container:<br align="left" /></td>
                                                         <td align="text">/mnt/chronos:ro<br align="left" /></td>
                                                         </tr>
                                                         </table>
                                                         >];
                                           BIND_MONGODB_INIT_OAI [label=<
                                                                  <table border="0">
                                                                  <tr>
                                                                  <td align="text"><b>host:</b><br align="left" /></td>
                                                                  <td align="text">$REPO/container_init/mongodb/init_oai_sets.json<br align="left" /></td>
                                                                  </tr>
                                                                  <tr>
                                                                  <td align="text">mongodb-container:<br align="left" /></td>
                                                                  <td align="text">/mnt/init_oai_sets.json:ro<br align="left" /></td>
                                                                  </tr>
                                                                  </table>
                                                                  >];
                                           BIND_MONGODB_INIT [label=<
                                                              <table border="0">
                                                              <tr>
                                                              <td align="text"><b>host:</b><br align="left" /></td>
                                                              <td align="text">$REPO/container_init/mongodb/mongodb-after-entry.sh<br align="left" /></td>
                                                              </tr>
                                                              <tr>
                                                              <td align="text">mongodb-container:<br align="left" /></td>
                                                              <td align="text">/docker-entrypoint-initdb.d/mongodb-after-entry.sh:ro<br align="left" /></td>
                                                              </tr>
                                                              </table>
                                                              >];
                                           BIND_SOLR_INIT [label=<
                                                           <table border="0">
                                                           <tr>
                                                           <td align="text"><b>host:</b><br align="left" /></td>
                                                           <td align="text">$REPO/container_init/solr/phaidra_core<br align="left" /></td>
                                                           </tr>
                                                           <tr>
                                                           <td align="text">solr-container:<br align="left" /></td>
                                                           <td align="text">/tmp/phaidra:ro<br align="left" /></td>
                                                           </tr>
                                                           </table>
                                                           >];
                                           BIND_PIXELGECKO [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/src/pixelgecko<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">pixelgecko-container:<br align="left" /></td>
                                                            <td align="text">/opt/pixelgecko:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_PROMTAIL_LOCAL [label=<
                                                                <table border="0">
                                                                <tr>
                                                                <td align="text"><b>host:</b><br align="left" /></td>
                                                                <td align="text">$REPO/container_init/promtail/promtail-local-config.yaml<br align="left" /></td>
                                                                </tr>
                                                                <tr>
                                                                <td align="text">promtail-local-container:<br align="left" /></td>
                                                                <td align="text">/etc/promtail/config.yaml:ro<br align="left" /></td>
                                                                </tr>
                                                                </table>
                                                                >];
                                           BIND_LOKI [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$REPO/container_init/loki/loki-docker-config.yaml<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">loki-container:<br align="left" /></td>
                                                      <td align="text">/etc/loki/local-config.yaml:ro<br align="left" /></td>
                                                      </tr>
                                                      </table>
                                                      >];
                                           BIND_GRAFANA_DS [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/container_init/grafana/ds.yaml<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">grafana-container:<br align="left" /></td>
                                                            <td align="text">/etc/grafana/provisioning/datasources/ds.yaml:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_GRAFANA_DD [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/container_init/grafana/dd.yaml<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">grafana-container:<br align="left" /></td>
                                                            <td align="text">/etc/grafana/provisioning/dashboards/dd.yaml:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_GRAFANA_DASHBOARDS [label=<
                                                                    <table border="0">
                                                                    <tr>
                                                                    <td align="text"><b>host:</b><br align="left" /></td>
                                                                    <td align="text">$REPO/container_init/grafana/dashboards<br align="left" /></td>
                                                                    </tr>
                                                                    <tr>
                                                                    <td align="text">grafana-container:<br align="left" /></td>
                                                                    <td align="text">/etc/grafana/provisioning/dashboards:ro<br align="left" /></td>
                                                                    </tr>
                                                                    </table>
                                                                    >];
                                                            }
                                                    }

                                                    subgraph cluster_docker_network_host {
                                                            label="PHAIDRA docker containers";
                                                            color = green;
                                                            node [shape = component, style = solid, color = green]
                                                            C_FEDORA [label="phaidra-ssl-fedora-1",
                                                                      URL="https://fedora.lyrasis.org/"];
                                                            C_API [label="phaidra-ssl-api-1",
                                                                   URL="https://github.com/phaidra/phaidra-api"];
                                                            C_MARIADB_PHAIDRA [label="phaidra-ssl-mariadb-phaidra-1",
                                                                               URL="https://mariadb.org/"];
                                                            C_MONGODB_PHAIDRA [label="phaidra-ssl-mongodb-phaidra-1",
                                                                               URL="https://www.mongodb.com/"];
                                                            C_UI [label="phaidra-ssl-ui-1",
                                                                  URL="https://github.com/phaidra/phaidra-ui"];
                                                            C_OPENLDAP [label="phaidra-ssl-openldap-1",
                                                                        URL="https://www.openldap.org/"];
                                                            C_SOLR [label="phaidra-ssl-solr-1",
                                                                    URL="https://solr.apache.org/"];
                                                            C_IMAGESERVER [label="phaidra-ssl-imageserver-1",
                                                                           URL="https://github.com/ruven/iipsrv"];
                                                            C_PIXELGECKO [label="phaidra-ssl-pixelgecko-1"];
                                                            C_DBGATE [label="phaidra-ssl-dbgate-1"];
                                                            C_LAM [label="phaidra-ssl-lam-1"];
                                                            C_MARIADB_FEDORA [label="phaidra-ssl-mariadb-fedora-1",
                                                                              URL="https://mariadb.org/"];
                                                            C_CHRONOS [label="phaidra-ssl-chronos-1"];
                                                            WEBSERVER [label="phaidra-ssl-httpd-1"];
                                                            C_PROMTAIL_LOCAL [label="phaidra-demo-promtail-local-1",
                                                                              URL="https://grafana.com/docs/loki/latest/send-data/promtail/"];
                                                            C_GRAFANA [label="phaidra-demo-grafana-1",
                                                                       URL="https://grafana.com/docs/grafana/latest/getting-started/"];
                                                            C_LOKI [label="phaidra-demo-loki-1",
                                                                    URL="https://grafana.com/docs/loki/latest/"];
                                                            }
                                                    }

                                                    // storage mapping

                                                    HS_FEDORA -- C_FEDORA [color="turquoise"];

                                                    HS_FEDORA -- C_API [color="turquoise"];
                                                    BIND_API_CODE, BIND_API_ENTRYPOINT -- C_API [color="blue"];

                                                    BIND_MARIADB_PHAIDRA_INIT-- C_MARIADB_PHAIDRA [color="blue"];
                                                    HS_MARIADB_PHAIDRA -- C_MARIADB_PHAIDRA [color="turquoise"];

                                                    HS_MONGODB_PHAIDRA -- C_MONGODB_PHAIDRA [color="turquoise"];
                                                    BIND_MONGODB_INIT,BIND_MONGODB_INIT_OAI -- C_MONGODB_PHAIDRA [color="blue"];

                                                    HS_OPENLDAP -- C_OPENLDAP [color="turquoise"];
                                                    BIND_OPENLDAP_INIT -- C_OPENLDAP [color="blue"];

                                                    HS_SOLR -- C_SOLR [color="turquoise"];
                                                    BIND_SOLR_INIT -- C_SOLR [color="blue"];

                                                    HS_PIXELGECKO -- C_IMAGESERVER [color="turquoise"];

                                                    HS_FEDORA -- C_PIXELGECKO [color="turquoise"];
                                                    HS_PIXELGECKO -- C_PIXELGECKO [color="turquoise"];
                                                    BIND_PIXELGECKO -- C_PIXELGECKO [color="blue"];

                                                    HS_DBGATE -- C_DBGATE [color="turquoise"];

                                                    HS_MARIADB_FEDORA -- C_MARIADB_FEDORA [color="turquoise"];

                                                    WEBSERVER -- BIND_HTTPD_CONFIG, BIND_DOCUMENTATION [color="blue"];
                                                    WEBSERVER -- HS_SITEMAPS [color="turquoise"];

                                                    C_CHRONOS -- HS_DATABASE_DUMPS,HS_SITEMAPS,HS_OAI_LOGS [color="turquoise"];
                                                    C_CHRONOS -- BIND_CHRONOS [color="blue"];

                                                    C_GRAFANA -- HS_GRAFANA [color="turquoise"];
                                                    C_GRAFANA -- BIND_GRAFANA_DD, BIND_GRAFANA_DS, BIND_GRAFANA_DASHBOARDS [color="blue"];

                                                    C_LOKI -- HS_LOKI [color="turquoise"];
                                                    C_LOKI -- BIND_LOKI [color="blue"];

                                                    C_PROMTAIL_LOCAL -- BIND_PROMTAIL_LOCAL [color="blue"];

                                                    // system communication mapping

                                                    C_FEDORA -- C_MARIADB_FEDORA [color="orange"];
                                                    C_API -- C_FEDORA,C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_UI,C_OPENLDAP,C_SOLR,C_IMAGESERVER [color="orange"];
                                                    C_MONGODB_PHAIDRA -- C_PIXELGECKO [color="orange"];
                                                    C_OPENLDAP -- C_LAM [color="orange"];
                                                    C_DBGATE -- C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_MARIADB_FEDORA [color="orange"];
                                                    WEBSERVER -- C_FEDORA,C_API,C_UI,C_SOLR,C_DBGATE,C_LAM [color="magenta"];
                                                    C_CHRONOS -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API [color="orange"];
                                                    C_PROMTAIL_LOCAL -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API,C_UI,C_IMAGESERVER,WEBSERVER,C_OPENLDAP,C_LAM,C_DBGATE,C_CHRONOS,C_PIXELGECKO, C_FEDORA [color="black"];
                                                    C_PROMTAIL_LOCAL -- C_LOKI [color="orange"];
                                                    C_GRAFANA -- C_LOKI [color="orange"];


                                                    // outside communication mapping

                                                    USER -- WEBSERVER [color="red"];
                                            }

#+end_src

#+RESULTS: construction-ssl
[[file:./pictures/construction_ssl.svg]]

* Shibboleth version
#+NAME: construction-shib
#+begin_src dot :file "./pictures/construction_shib.svg"
  graph G {
          rankdir="LR"

          USER [label="PHAIDRA USER", shape = tripleoctagon];
          IDP [label="Shibboleth IdP", shape = signature];

          subgraph cluster_host {
                  label = "PHAIDRA server firewall";
                  color = red;

                  subgraph cluster_host_storage {
                          label = "PHAIDRA server filesystem";
                          color = blue;
                          subgraph cluster_named_volumes {
                                  label = "Named volumes";
                                  color = turquoise;
                                  node [shape = folder, style = solid, color = turquoise]
                                  HS_FEDORA [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_fedora/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">fedora-container:<br align="left" /></td>
                                             <td align="text">/usr/local/tomcat/fcrepo-home<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">pixelgecko-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">api-container:<br align="left" /></td>
                                             <td align="text"> /mnt/fedora:ro<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_mariadb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                                      <td align="text">/var/lib/mysql<br align="left" /></td>
                                                      </tr>
                                                      </table>
                                                      >];
                                  HS_MONGODB_PHAIDRA [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_mongodb_phaidra/_data<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">phaidra-mongodb-container:<br align="left" /></td>
                                                      <td align="text">/data/db<br align="left" /></td></tr>
                                                      </table>
                                                      >];
                                  HS_OPENLDAP [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_openldap/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">openldap-container:<br align="left" /></td>
                                               <td align="text">/bitnami/openldap<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_SOLR [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_solr/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">solr-container:<br align="left" /></td>
                                           <td align="text">/var/solr<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];
                                  HS_PIXELGECKO [label=<
                                                 <table border="0">
                                                 <tr>
                                                 <td align="text"><b>host:</b><br align="left" /></td>
                                                 <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_pixelgecko/_data<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">pixelgecko-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images<br align="left" /></td>
                                                 </tr>
                                                 <tr>
                                                 <td align="text">imageserver-container:<br align="left" /></td>
                                                 <td align="text">/mnt/converted_images:ro<br align="left" /></td>
                                                 </tr>
                                                 </table>
                                                 >];
                                  HS_DBGATE [label=<
                                             <table border="0">
                                             <tr>
                                             <td align="text"><b>host:</b><br align="left" /></td>
                                             <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_dbgate/_data<br align="left" /></td>
                                             </tr>
                                             <tr>
                                             <td align="text">dbgate-container:<br align="left" /></td>
                                             <td align="text">/root/.dbgate<br align="left" /></td>
                                             </tr>
                                             </table>
                                             >];
                                  HS_MARIADB_FEDORA [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_mariadb_fedora/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">mariadb-fedora-container:<br align="left" /></td>
                                                     <td align="text">/var/lib/mysql<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_DATABASE_DUMPS [label=<
                                                     <table border="0">
                                                     <tr>
                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                     <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_chronos_database_dumps/_data<br align="left" /></td>
                                                     </tr>
                                                     <tr>
                                                     <td align="text">chronos-container:<br align="left" /></td>
                                                     <td align="text">/mnt/database-dumps<br align="left" /></td>
                                                     </tr>
                                                     </table>
                                                     >];
                                  HS_SITEMAPS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_chronos_sitemaps/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">httpd-container:<br align="left" /></td>
                                               <td align="text">/mnt/sitemaps:ro<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_OAI_LOGS [label=<
                                               <table border="0">
                                               <tr>
                                               <td align="text"><b>host:</b><br align="left" /></td>
                                               <td align="text">$HOME/.local/share/docker/volumes/phaidra-shib_chronos_oai_logs/_data<br align="left" /></td>
                                               </tr>
                                               <tr>
                                               <td align="text">chronos-container:<br align="left" /></td>
                                               <td align="text">/mnt/oai-logs<br align="left" /></td>
                                               </tr>
                                               </table>
                                               >];
                                  HS_GRAFANA [label=<
                                              <table border="0">
                                              <tr>
                                              <td align="text"><b>host:</b><br align="left" /></td>
                                              <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_grafana/_data<br align="left" /></td>
                                              </tr>
                                              <tr>
                                              <td align="text">grafana-container:<br align="left" /></td>
                                              <td align="text">/var/lib/grafana<br align="left" /></td>
                                              </tr>
                                              </table>
                                              >];
                                  HS_LOKI [label=<
                                           <table border="0">
                                           <tr>
                                           <td align="text"><b>host:</b><br align="left" /></td>
                                           <td align="text">$HOME/.local/share/docker/volumes/phaidra-demo_loki/_data<br align="left" /></td>
                                           </tr>
                                           <tr>
                                           <td align="text">loki-container:<br align="left" /></td>
                                           <td align="text">/loki<br align="left" /></td>
                                           </tr>
                                           </table>
                                           >];
                                   }
                                   subgraph cluster_bind_mounts {
                                           label = "Bind mounts";
                                           node [shape = folder, style = solid, color = blue]
                                           BIND_MARIADB_PHAIDRA_INIT[label=<
                                                                     <table border="0">
                                                                     <tr>
                                                                     <td align="text"><b>host:</b><br align="left" /></td>
                                                                     <td align="text">$REPO/container_init/mariadb/phaidradb.sql.gz<br align="left" /></td>
                                                                     </tr>
                                                                     <tr>
                                                                     <td align="text">mariadb-phaidra-container:<br align="left" /></td>
                                                                     <td align="text">/docker-entrypoint-initdb.d/phaidradb.sql.gz:ro<br align="left" /></td>
                                                                     </tr>
                                                                     </table>
                                                                     >];
                                           BIND_OPENLDAP_INIT [label=<
                                                               <table border="0">
                                                               <tr>
                                                               <td align="text"><b>host:</b><br align="left" /></td>
                                                               <td align="text">$REPO/container_init/openldap<br align="left" /></td>
                                                               </tr>
                                                               <tr>
                                                               <td align="text">openldap-container:<br align="left" /></td>
                                                               <td align="text">/ldifs:ro<br align="left" /></td>
                                                               </tr>
                                                               </table>
                                                               >];
                                           BIND_HTTPD_CONFIG [label=<
                                                              <table border="0">
                                                              <tr>
                                                              <td align="text"><b>host:</b><br align="left" /></td>
                                                              <td align="text">$REPO/container_init/httpd/phaidra-shib:ro<br align="left" /></td>
                                                              </tr>
                                                              <tr>
                                                              <td align="text">httpd-container:<br align="left" /></td>
                                                              <td align="text">/mnt/startup:ro<br align="left" /></td>
                                                              </tr>
                                                              </table>
                                                              >];
                                           BIND_API_CODE [label=<
                                                          <table border="0">
                                                          <tr>
                                                          <td align="text"><b>host:</b><br align="left" /></td>
                                                          <td align="text">$REPO/src/phaidra-api<br align="left" /></td>
                                                          </tr>
                                                          <tr>
                                                          <td align="text">api-container:<br align="left" /></td>
                                                          <td align="text">/usr/local/phaidra/phaidra-api:ro<br align="left" /></td>
                                                          </tr>
                                                          </table>
                                                          >];
                                           BIND_API_ENTRYPOINT [label=<
                                                                <table border="0">
                                                                <tr>
                                                                <td align="text"><b>host:</b><br align="left" /></td>
                                                                <td align="text">$REPO/container_init/api/api-entrypoint.bash<br align="left" /></td>
                                                                </tr>
                                                                <tr>
                                                                <td align="text">api-container:<br align="left" /></td>
                                                                <td align="text">/mnt/api-entrypoint.bash:ro<br align="left" /></td>
                                                                </tr>
                                                                </table>
                                                                >];
                                           BIND_DOCUMENTATION [label=<
                                                               <table border="0">
                                                               <tr>
                                                               <td align="text"><b>host:</b><br align="left" /></td>
                                                               <td align="text">$REPO/docs<br align="left" /></td>
                                                               </tr>
                                                               <tr>
                                                               <td align="text">httpd-container:<br align="left" /></td>
                                                               <td align="text">/mnt/docs:ro<br align="left" /></td>
                                                               </tr>
                                                               </table>
                                                               >];
                                           BIND_CHRONOS [label=<
                                                         <table border="0">
                                                         <tr>
                                                         <td align="text"><b>host:</b><br align="left" /></td>
                                                         <td align="text">$REPO/container_init/chronos<br align="left" /></td>
                                                         </tr>
                                                         <tr>
                                                         <td align="text">chronos-container:<br align="left" /></td>
                                                         <td align="text">/mnt/chronos:ro<br align="left" /></td>
                                                         </tr>
                                                         </table>
                                                         >];
                                           BIND_MONGODB_INIT_OAI [label=<
                                                                  <table border="0">
                                                                  <tr>
                                                                  <td align="text"><b>host:</b><br align="left" /></td>
                                                                  <td align="text">$REPO/container_init/mongodb/init_oai_sets.json<br align="left" /></td>
                                                                  </tr>
                                                                  <tr>
                                                                  <td align="text">mongodb-container:<br align="left" /></td>
                                                                  <td align="text">/mnt/init_oai_sets.json:ro<br align="left" /></td>
                                                                  </tr>
                                                                  </table>
                                                                  >];
                                           BIND_MONGODB_INIT [label=<
                                                              <table border="0">
                                                              <tr>
                                                              <td align="text"><b>host:</b><br align="left" /></td>
                                                              <td align="text">$REPO/container_init/mongodb/mongodb-after-entry.sh<br align="left" /></td>
                                                              </tr>
                                                              <tr>
                                                              <td align="text">mongodb-container:<br align="left" /></td>
                                                              <td align="text">/docker-entrypoint-initdb.d/mongodb-after-entry.sh:ro<br align="left" /></td>
                                                              </tr>
                                                              </table>
                                                              >];
                                           BIND_SOLR_INIT [label=<
                                                           <table border="0">
                                                           <tr>
                                                           <td align="text"><b>host:</b><br align="left" /></td>
                                                           <td align="text">$REPO/container_init/solr/phaidra_core<br align="left" /></td>
                                                           </tr>
                                                           <tr>
                                                           <td align="text">solr-container:<br align="left" /></td>
                                                           <td align="text">/tmp/phaidra:ro<br align="left" /></td>
                                                           </tr>
                                                           </table>
                                                           >];
                                           BIND_PIXELGECKO [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/src/pixelgecko<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">pixelgecko-container:<br align="left" /></td>
                                                            <td align="text">/opt/pixelgecko:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_PROMTAIL_LOCAL [label=<
                                                                <table border="0">
                                                                <tr>
                                                                <td align="text"><b>host:</b><br align="left" /></td>
                                                                <td align="text">$REPO/container_init/promtail/promtail-local-config.yaml<br align="left" /></td>
                                                                </tr>
                                                                <tr>
                                                                <td align="text">promtail-local-container:<br align="left" /></td>
                                                                <td align="text">/etc/promtail/config.yaml:ro<br align="left" /></td>
                                                                </tr>
                                                                </table>
                                                                >];
                                           BIND_LOKI [label=<
                                                      <table border="0">
                                                      <tr>
                                                      <td align="text"><b>host:</b><br align="left" /></td>
                                                      <td align="text">$REPO/container_init/loki/loki-docker-config.yaml<br align="left" /></td>
                                                      </tr>
                                                      <tr>
                                                      <td align="text">loki-container:<br align="left" /></td>
                                                      <td align="text">/etc/loki/local-config.yaml:ro<br align="left" /></td>
                                                      </tr>
                                                      </table>
                                                      >];
                                           BIND_GRAFANA_DS [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/container_init/grafana/ds.yaml<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">grafana-container:<br align="left" /></td>
                                                            <td align="text">/etc/grafana/provisioning/datasources/ds.yaml:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_GRAFANA_DD [label=<
                                                            <table border="0">
                                                            <tr>
                                                            <td align="text"><b>host:</b><br align="left" /></td>
                                                            <td align="text">$REPO/container_init/grafana/dd.yaml<br align="left" /></td>
                                                            </tr>
                                                            <tr>
                                                            <td align="text">grafana-container:<br align="left" /></td>
                                                            <td align="text">/etc/grafana/provisioning/dashboards/dd.yaml:ro<br align="left" /></td>
                                                            </tr>
                                                            </table>
                                                            >];
                                           BIND_GRAFANA_DASHBOARDS [label=<
                                                                    <table border="0">
                                                                    <tr>
                                                                    <td align="text"><b>host:</b><br align="left" /></td>
                                                                    <td align="text">$REPO/container_init/grafana/dashboards<br align="left" /></td>
                                                                    </tr>
                                                                    <tr>
                                                                    <td align="text">grafana-container:<br align="left" /></td>
                                                                    <td align="text">/etc/grafana/provisioning/dashboards:ro<br align="left" /></td>
                                                                    </tr>
                                                                    </table>
                                                                    >];
                                                            }
                                                    }

                                                    subgraph cluster_docker_network_host {
                                                            label="PHAIDRA docker containers";
                                                            color = green;
                                                            node [shape = component, style = solid, color = green]
                                                            C_FEDORA [label="phaidra-shib-fedora-1",
                                                                      URL="https://fedora.lyrasis.org/"];
                                                            C_API [label="phaidra-shib-api-1",
                                                                   URL="https://github.com/phaidra/phaidra-api"];
                                                            C_MARIADB_PHAIDRA [label="phaidra-shib-mariadb-phaidra-1",
                                                                               URL="https://mariadb.org/"];
                                                            C_MONGODB_PHAIDRA [label="phaidra-shib-mongodb-phaidra-1",
                                                                               URL="https://www.mongodb.com/"];
                                                            C_UI [label="phaidra-shib-ui-1",
                                                                  URL="https://github.com/phaidra/phaidra-ui"];
                                                            C_OPENLDAP [label="phaidra-shib-openldap-1",
                                                                        URL="https://www.openldap.org/"];
                                                            C_SOLR [label="phaidra-shib-solr-1",
                                                                    URL="https://solr.apache.org/"];
                                                            C_IMAGESERVER [label="phaidra-shib-imageserver-1",
                                                                           URL="https://github.com/ruven/iipsrv"];
                                                            C_PIXELGECKO [label="phaidra-shib-pixelgecko-1"];
                                                            C_DBGATE [label="phaidra-shib-dbgate-1"];
                                                            C_LAM [label="phaidra-shib-lam-1"];
                                                            C_MARIADB_FEDORA [label="phaidra-shib-mariadb-fedora-1",
                                                                              URL="https://mariadb.org/"];
                                                            C_CHRONOS [label="phaidra-demo-chronos-1"];
                                                            WEBSERVER [label="phaidra-shib-httpd-1"];
                                                            C_PROMTAIL_LOCAL [label="phaidra-demo-promtail-local-1",
                                                                              URL="https://grafana.com/docs/loki/latest/send-data/promtail/"];
                                                            C_GRAFANA [label="phaidra-demo-grafana-1",
                                                                       URL="https://grafana.com/docs/grafana/latest/getting-started/"];
                                                            C_LOKI [label="phaidra-demo-loki-1",
                                                                    URL="https://grafana.com/docs/loki/latest/"];
                                                            }
                                                    }

                                                    // storage mapping

                                                    HS_FEDORA -- C_FEDORA [color="turquoise"];

                                                    HS_FEDORA -- C_API [color="turquoise"];
                                                    BIND_API_CODE, BIND_API_ENTRYPOINT -- C_API [color="blue"];

                                                    BIND_MARIADB_PHAIDRA_INIT-- C_MARIADB_PHAIDRA [color="blue"];
                                                    HS_MARIADB_PHAIDRA -- C_MARIADB_PHAIDRA [color="turquoise"];

                                                    HS_MONGODB_PHAIDRA -- C_MONGODB_PHAIDRA [color="turquoise"];
                                                    BIND_MONGODB_INIT,BIND_MONGODB_INIT_OAI -- C_MONGODB_PHAIDRA [color="blue"];

                                                    HS_OPENLDAP -- C_OPENLDAP [color="turquoise"];
                                                    BIND_OPENLDAP_INIT -- C_OPENLDAP [color="blue"];

                                                    HS_SOLR -- C_SOLR [color="turquoise"];
                                                    BIND_SOLR_INIT [color="blue"];

                                                    HS_PIXELGECKO -- C_IMAGESERVER [color="turquoise"];

                                                    HS_FEDORA -- C_PIXELGECKO [color="turquoise"];
                                                    HS_PIXELGECKO -- C_PIXELGECKO [color="turquoise"];
                                                    BIND_PIXELGECKO -- C_PIXELGECKO [color="blue"];

                                                    HS_DBGATE -- C_DBGATE [color="turquoise"];

                                                    HS_MARIADB_FEDORA -- C_MARIADB_FEDORA [color="turquoise"];

                                                    WEBSERVER -- BIND_HTTPD_CONFIG,BIND_DOCUMENTATION [color="blue"];
                                                    WEBSERVER -- HS_SITEMAPS [color="turquoise"];

                                                    C_CHRONOS -- HS_DATABASE_DUMPS,HS_SITEMAPS,HS_OAI_LOGS [color="turquoise"];
                                                    C_CHRONOS -- BIND_CHRONOS [color="blue"];

                                                    C_GRAFANA -- HS_GRAFANA [color="turquoise"];
                                                    C_GRAFANA -- BIND_GRAFANA_DD, BIND_GRAFANA_DS, BIND_GRAFANA_DASHBOARDS [color="blue"];

                                                    C_LOKI -- HS_LOKI [color="turquoise"];
                                                    C_LOKI -- BIND_LOKI [color="blue"];

                                                    C_PROMTAIL_LOCAL -- BIND_PROMTAIL_LOCAL [color="blue"];

                                                    // system communication mapping

                                                    C_FEDORA -- C_MARIADB_FEDORA [color="orange"];
                                                    C_API -- C_FEDORA,C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_UI,C_OPENLDAP,C_SOLR,C_IMAGESERVER [color="orange"];
                                                    C_MONGODB_PHAIDRA -- C_PIXELGECKO [color="orange"];
                                                    C_OPENLDAP -- C_LAM [color="orange"];
                                                    C_DBGATE -- C_MARIADB_PHAIDRA,C_MONGODB_PHAIDRA,C_MARIADB_FEDORA [color="orange"];
                                                    WEBSERVER -- C_FEDORA,C_API,C_UI,C_SOLR,C_DBGATE,C_LAM [color="magenta"];
                                                    C_CHRONOS -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API [color="orange"];
                                                    C_PROMTAIL_LOCAL -- C_MONGODB_PHAIDRA,C_MARIADB_PHAIDRA,C_MARIADB_FEDORA,C_SOLR,C_API,C_UI,C_IMAGESERVER,WEBSERVER,C_OPENLDAP,C_LAM,C_DBGATE,C_CHRONOS,C_PIXELGECKO, C_FEDORA [color="black"];
                                                    C_PROMTAIL_LOCAL -- C_LOKI [color="orange"];
                                                    C_GRAFANA -- C_LOKI [color="orange"];


                                                    // outside communication mapping

                                                    USER -- WEBSERVER [color="red"];
                                                    IDP -- WEBSERVER [color="red"];
                                            }


#+end_src

#+RESULTS: construction-shib
[[file:./pictures/construction_shib.svg]]

